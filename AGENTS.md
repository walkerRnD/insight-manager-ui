<general_rules>
- Prefer existing patterns and locations:
  - UI components live under src/lib/components/ui/<component> with a Svelte file and an index.ts re-export. Follow src/lib/components/ui/button/ as the canonical example. Export the Svelte component as Root and re-export it as Button from index.ts.
  - Utilities live in src/lib/utils.ts. Reuse the existing cn(...inputs) helper for Tailwind class merging. If you add new generic utilities, place them in src/lib/utils.ts; only create additional files under src/lib/utils/ if the module becomes large or domain-specific.
  - Server-only code should go under src/lib/server/** so it’s naturally excluded from client/browser tests (see vitest config excludes src/lib/server/** for the client project).
  - Routes follow SvelteKit file-based routing: +layout.svelte, +page.svelte, etc. See src/routes/ for examples. Keep demos in src/routes/demo/.
- Internationalization (Paraglide/inlang):
  - Do NOT edit generated code under src/lib/paraglide (it’s generated by the Vite plugin). Update locale messages in messages/*.json and adjust project.inlang/settings.json if needed; the generator runs during dev/build via the plugin configured in vite.config.ts.
  - Use the m message API from $lib/paraglide/messages and setLocale from $lib/paraglide/runtime inside Svelte components (see src/routes/demo/paraglide/+page.svelte).
  - URL localization is handled in src/hooks.ts and src/hooks.server.ts via paraglideMiddleware and deLocalizeUrl. Don’t bypass these; extend them if you need custom behavior.
- Styling and components:
  - Tailwind CSS is enabled via @tailwindcss/vite and src/app.css. Prefer Tailwind utility classes. Use tailwind-variants (tv) for variantable components and the cn helper to merge classes (see src/lib/components/ui/button/button.svelte).
  - When importing TS modules from Svelte files, use .js extensions (SvelteKit resolves TS at build time). For example: import { Button } from '$lib/components/ui/button/index.js' and import { cn } from '$lib/utils.js'.
- TypeScript and Svelte:
  - TypeScript is strict (see tsconfig.json). Svelte 5 runes APIs are used ($props, $bindable). Follow existing component patterns for props/typing.
- Scripts to know (from package.json):
  - dev: vite dev
  - build: vite build
  - preview: vite preview
  - prepare: svelte-kit sync (runs on install)
  - check: svelte-kit sync && svelte-check --tsconfig ./tsconfig.json
  - check:watch: svelte-check ... --watch
  - test:unit: vitest
  - test: npm run test:unit -- --run && npm run test:e2e
  - test:e2e: playwright test
  Run npm run check and npm test locally before opening a PR.
- Environments and secrets:
  - Never commit secrets. Use .env/.env.* files locally; .env is gitignored. Provide defaults/safe values in .env.example or .env.test if needed.
- Node and package management:
  - .npmrc sets engine-strict=true. Use a Node version compatible with the toolchain (TypeScript ^5, Vite ^7, Svelte ^5). Prefer npm (scripts assume npm), though pnpm/yarn may work. Avoid mixing package managers.
- Repository hygiene:
  - Obey .gitignore; do not commit generated artifacts (/.svelte-kit, /build, src/lib/paraglide, etc.).
  - Keep changes scoped; follow existing naming and folder conventions. Before creating new modules/components, search the repo for an existing equivalent.
</general_rules>

<repository_structure>
- Root configuration and tooling:
  - package.json: scripts and dependencies for SvelteKit, Vitest, Playwright, Tailwind, Paraglide.
  - vite.config.ts: Vite plugins (tailwindcss, sveltekit, vite-plugin-devtools-json, @inlang/paraglide-js). Also defines Vitest projects (client browser + server node).
  - svelte.config.js: Uses @sveltejs/adapter-vercel.
  - tsconfig.json: Extends .svelte-kit/tsconfig.json with strict compiler options.
  - playwright.config.ts: E2E setup; starts webServer via build+preview on port 4173 and runs tests in e2e/.
  - components.json: shadcn-svelte style config (aliases for $lib, $lib/components, etc.).
  - project.inlang/settings.json and messages/*.json: Paraglide/inlang i18n configuration and locale messages.
  - .npmrc: engine-strict=true. .gitignore: ignores build artifacts, env files, and src/lib/paraglide.
- Application source (src/):
  - src/app.html: Base HTML template with %paraglide.lang% placeholder.
  - src/app.css: Tailwind entry; includes @tailwindcss/forms and @tailwindcss/typography plugins.
  - src/routes/: SvelteKit routes (e.g., +layout.svelte, +page.svelte, demo/ and demo/paraglide/ examples). Tests for pages may live nearby (e.g., src/routes/page.svelte.spec.ts).
  - src/lib/: Reusable code and assets.
    - src/lib/components/ui/button/: Button component (button.svelte) and index.ts re-exports (Root as Button, types, variants).
    - src/lib/utils.ts: cn utility and shared types.
    - src/lib/assets/: Static assets (e.g., favicon.svg).
    - src/lib/paraglide/: Generated i18n runtime (gitignored; created by the Vite plugin).
  - src/hooks.ts and src/hooks.server.ts: Paraglide-powered rerouting and middleware integration.
  - src/app.d.ts: Global TypeScript definitions for SvelteKit.
- Tests:
  - Unit/component tests in src/**/*.spec.ts|test.ts and src/**/*.svelte.spec.ts (Vitest). Browser tests for .svelte components; Node tests for non-Svelte modules.
  - E2E tests in e2e/ (Playwright).
</repository_structure>

<dependencies_and_installation>
- Requirements:
  - Node.js LTS compatible with SvelteKit/Vite/TypeScript. .npmrc enforces engine-strict; ensure your Node version meets dependency engine ranges.
- Install dependencies:
  - npm install
  - The prepare script (svelte-kit sync) runs automatically after install.
- Dev server and builds:
  - Start dev: npm run dev (optional: npm run dev -- --open)
  - Build: npm run build
  - Preview build: npm run preview
- Tailwind:
  - Already configured; styles are authored in src/app.css and utility classes in components.
- Paraglide/inlang:
  - The Vite plugin generates src/lib/paraglide at dev/build time from messages/*.json and project.inlang/settings.json; no separate generation step needed.
- Playwright browsers:
  - If Playwright prompts for browser binaries, run: npx playwright install
</dependencies_and_installation>

<testing_instructions>
- Test frameworks:
  - Unit and component testing: Vitest. Configured with two projects in vite.config.ts.
    - client project: environment=browser with Playwright provider; includes src/**/*.svelte.{test,spec}.{js,ts}; excludes src/lib/server/**; setup via vitest-setup-client.ts; use vitest-browser-svelte render and @vitest/browser/context page utilities.
    - server project: environment=node; includes src/**/*.{test,spec}.{js,ts}; excludes *.svelte tests.
  - E2E testing: Playwright, tests under e2e/.
- Commands:
  - Run unit tests: npm run test:unit (use --ui/--watch flags as needed)
  - Run E2E tests: npm run test:e2e (playwright.config.ts auto-builds and previews the app)
  - Full test suite: npm test (runs unit tests with --run then E2E)
- Writing tests:
  - Component tests: import the Svelte component and render it with vitest-browser-svelte. Query via @vitest/browser/context page.
    - Example: see src/routes/page.svelte.spec.ts using render(Page) and toBeInTheDocument matcher.
  - Server/unit tests: test pure TS modules (e.g., utilities) with Node environment.
  - Assertions: expect.requireAssertions is enabled; ensure at least one assertion per test.
- Tips:
  - Avoid importing src/lib/paraglide generated files directly in unit tests; rely on public APIs (messages m, runtime functions) and add messages under messages/ for i18n coverage.
  - If a test needs the built app, prefer E2E with Playwright.
</testing_instructions>

<pull_request_formatting>
</pull_request_formatting>

